<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace 写入 自己 dao 里的接口名称-->
<mapper namespace="com.nsu.stu.meet.dao.UserMapper">
    <select id="selectBaseFromUser" resultType="com.nsu.stu.meet.model.dto.user.UserBaseDto">
        <bind name="followStatus" value="@com.nsu.stu.meet.model.enums.RelationEnums@FOLLOW.value()"/>
        SELECT
        mu.user_id,
        mu.nickname,
        mu.avatar,
        mu.like_total,
        mu.background,
        COUNT( mur.src_id = #{userId}  OR NULL) AS followSum,
        COUNT( mur.dest_id = #{userId}  OR NULL) AS fanSum
        FROM
        mt_user mu
        LEFT JOIN mt_user_relation mur ON mur.`status` = #{followStatus}
        WHERE
        mu.user_id = #{userId}
        AND mu.is_deleted = ${NOT_DELETED}
    </select>

    <select id="getFriendBaseByIds" resultType="com.nsu.stu.meet.model.dto.user.FriendBaseDto">
        SELECT user_id, nickname, avatar, intro, background
        FROM mt_user
        WHERE
        <choose>
            <when test="queryIds.size > 0">
                user_id IN
                <foreach collection="queryIds" item="queryId" open="(" close=")" separator=",">
                    #{queryId}
                </foreach>
            </when>
            <otherwise>
                1 = 0
            </otherwise>
        </choose>
        AND is_deleted = ${NOT_DELETED}
        ORDER BY gmt_create DESC
        LIMIT #{start}, #{end}

    </select>
</mapper>